{"version":3,"file":"clerk-react.esm.js","sources":["../src/utils/inBrowser.ts","../src/utils/scriptLoader.ts","../src/utils/useMaxAllowedInstancesGuard.tsx","../src/errors.ts","../src/isomorphicClerk.ts","../src/contexts/assertHelpers.ts","../src/contexts/StructureContext.tsx","../src/contexts/IsomorphicClerkContext.tsx","../src/contexts/ClientContext.tsx","../src/contexts/SessionContext.ts","../src/contexts/UserContext.tsx","../src/contexts/ClerkContextWrapper.tsx","../src/contexts/ClerkProvider.tsx","../src/components/uiComponents.tsx","../src/components/controlComponents.tsx"],"sourcesContent":["export default function inBrowser(): boolean {\n  return typeof window !== 'undefined';\n}\n","import { version } from '../../package.json';\n\nconst FAILED_TO_LOAD_ERROR = 'Clerk: Failed to load Clerk';\nconst MISSING_PROVIDER_ERROR = 'Clerk: Missing provider';\nconst MISSING_BODY_ERROR = 'Clerk: Missing <body> element.';\n\nfunction isStaging(frontendApi: string): boolean {\n  return (\n    frontendApi.endsWith('.lclstage.dev') ||\n    frontendApi.endsWith('.stgstage.dev') ||\n    frontendApi.endsWith('.clerkstage.dev')\n  );\n}\n\nfunction getScriptSrc(\n  frontendApi: string,\n  localScriptSrc: string | undefined,\n): string {\n  if (localScriptSrc) {\n    return localScriptSrc;\n  }\n\n  const majorVersion = isStaging(frontendApi)\n    ? 'staging'\n    : parseInt(version.split('.')[0], 10);\n\n  return `https://${frontendApi}/npm/@clerk/clerk-js@${majorVersion}/dist/clerk.browser.js`;\n}\n\nexport default function loadScript(\n  frontendApi: string,\n  localScriptSrc: string | undefined,\n): Promise<HTMLScriptElement | null> {\n  return new Promise((resolve, reject) => {\n    if (window.Clerk) {\n      resolve(null);\n    }\n\n    if (!frontendApi) {\n      reject(MISSING_PROVIDER_ERROR);\n    }\n\n    const script = document.createElement('script');\n    const src = getScriptSrc(frontendApi, localScriptSrc);\n\n    script.setAttribute('data-clerk-frontend-api', frontendApi);\n    script.setAttribute('crossorigin', 'anonymous');\n    script.async = true;\n\n    if (!document.body) {\n      reject(MISSING_BODY_ERROR);\n    }\n\n    script.addEventListener('load', () => resolve(script));\n    script.addEventListener('error', () => reject(FAILED_TO_LOAD_ERROR));\n\n    script.src = src;\n    document.body.appendChild(script);\n  });\n}\n","import React from 'react';\n\nconst counts = new Map<string, number>();\n\nexport function useMaxAllowedInstancesGuard(\n  name: string,\n  error: string,\n  maxCount = 1,\n): void {\n  React.useEffect(() => {\n    const count = counts.get(name) || 0;\n    if (count == maxCount) {\n      throw new Error(error);\n    }\n    counts.set(name, count + 1);\n\n    return () => {\n      counts.set(name, (counts.get(name) || 1) - 1);\n    };\n  }, []);\n}\n\nexport function withMaxAllowedInstancesGuard<P>(\n  WrappedComponent: React.ComponentType<P>,\n  name: string,\n  error: string,\n): React.ComponentType<P> {\n  const displayName =\n    WrappedComponent.displayName ||\n    WrappedComponent.name ||\n    name ||\n    'Component';\n  const Hoc = (props: P) => {\n    useMaxAllowedInstancesGuard(name, error);\n    return <WrappedComponent {...(props as P)} />;\n  };\n  Hoc.displayName = `withMaxAllowedInstancesGuard(${displayName})`;\n  return Hoc;\n}\n","export const noFrontendApiError =\n  'Clerk: You must add the frontendApi prop to your <ClerkProvider>';\n\nexport const noClerkProviderError =\n  'Clerk: You must wrap your application in a <ClerkProvider> component.';\n\nexport const noGuaranteedLoadedError = (hookName: string) =>\n  `Clerk: You're calling ${hookName} before there's a guarantee the client has been loaded. Call ${hookName} from a child of <SignedIn>, <SignedOut>, or <ClerkLoaded>, or use the withClerk() HOC.`;\n\nexport const noGuaranteedUserError = (hookName: string) =>\n  `Clerk: You're calling ${hookName} before there's a guarantee there's an active user. Call ${hookName} from a child of <SignedIn> or use the withUser() HOC.`;\n\nexport const multipleClerkProvidersError =\n  \"Clerk: You've added multiple <ClerkProvider> components in your React component tree. Wrap your components in a single <ClerkProvider>.\";\n\nexport const hocChildrenNotAFunctionError =\n  'Clerk: Child of WithClerk must be a function.';\n","import { inBrowser, loadScript } from './utils';\nimport { noFrontendApiError } from './errors';\nimport type {\n  BrowserClerk,\n  BrowserClerkConstructor,\n  ClerkOptions,\n} from './types';\nimport type {\n  ClientResource,\n  EnvironmentResource,\n  Resources,\n  SessionResource,\n  SignInProps,\n  SignOutCallback,\n  SignUpProps,\n  UserButtonProps,\n  UserProfileProps,\n  UserResource,\n} from '@clerk/types';\n\ntype MethodName<T> = {\n  [P in keyof T]: T[P] extends Function ? P : never;\n}[keyof T];\ntype MethodCallback = () => void;\n\nexport default class IsomorphicClerk {\n  private mode: string;\n  private frontendApi: string;\n  private options: ClerkOptions;\n  private ClerkConstructor: any;\n  private clerkjs: BrowserClerk | null = null;\n  private preopenSignIn?: null | SignInProps = null;\n  private preopenSignUp?: null | SignUpProps = null;\n  private premountSignInNodes = new Map<HTMLDivElement, SignInProps>();\n  private premountSignUpNodes = new Map<HTMLDivElement, SignUpProps>();\n  private premountUserProfileNodes = new Map<\n    HTMLDivElement,\n    UserProfileProps\n  >();\n  private premountUserButtonNodes = new Map<HTMLDivElement, UserButtonProps>();\n  private premountMethodCalls = new Map<\n    MethodName<BrowserClerk>,\n    MethodCallback\n  >();\n\n  private _loaded = false;\n\n  ssrData: string | null = null;\n  ssrClient?: ClientResource;\n  ssrSession?: SessionResource | null;\n\n  constructor(\n    frontendApi: string,\n    options: ClerkOptions = {},\n    Clerk: BrowserClerkConstructor | undefined | null,\n  ) {\n    this.frontendApi = frontendApi;\n    this.options = options;\n    this.ClerkConstructor = Clerk;\n\n    this.mode = inBrowser() ? 'browser' : 'server';\n\n    // TODO: Support SRR for NextJS\n    // const ssrDataNode = document.querySelector(`script[data-clerk=\"SSR\"]`);\n    // if (ssrDataNode) {\n    //   this.ssrData = ssrDataNode.innerHTML;\n    //   const parsedData = JSON.parse(this.ssrData);\n    //   this.ssrClient = parsedData.client;\n    //   this.ssrSession = parsedData.session;\n    // }\n  }\n\n  loadClerkJS() {\n    if (!this.frontendApi) {\n      void this.throwError(noFrontendApiError);\n      return Promise.resolve();\n    }\n\n    // Load a fixed Clerk version passed as a parameter\n    if (this.ClerkConstructor) {\n      window.Clerk = new this.ClerkConstructor(\n        this.frontendApi,\n      ) as BrowserClerk;\n\n      return window.Clerk.load(this.options)\n        .then(() => this.hydrateClerkJS(window.Clerk))\n        .catch(err => this.throwError(err.message || err));\n    }\n\n    // Hotload latest ClerkJS\n    return loadScript(this.frontendApi, this.options.scriptUrl)\n      .then(() => {\n        if (window.Clerk) {\n          return window.Clerk.load(this.options);\n        }\n        throw new Error('Failed to download latest Clerk JS');\n      })\n      .then(() => this.hydrateClerkJS(window.Clerk))\n      .catch(err => this.throwError(err.message || err));\n  }\n\n  // Custom wrapper to throw an error, since we need to apply different handling between\n  // production and development builds. In Next.js we can throw a full screen error in\n  // development mode. However, in production throwing an error results in an infinite loop\n  // as shown at https://github.com/vercel/next.js/issues/6973\n  throwError(errorMsg: string) {\n    if (process.env.NODE_ENV === 'production') {\n      console.error(errorMsg);\n      return Promise.resolve();\n    }\n    throw new Error(errorMsg);\n  }\n\n  private hydrateClerkJS = async (clerkjs: BrowserClerk | undefined) => {\n    if (!clerkjs) {\n      throw new Error('Failed to hydrate latest Clerk JS');\n    }\n\n    this.clerkjs = clerkjs;\n\n    this.premountMethodCalls.forEach(cb => cb());\n\n    if (this.preopenSignIn !== null) {\n      clerkjs.openSignIn(this.preopenSignIn);\n    }\n\n    if (this.preopenSignUp !== null) {\n      clerkjs.openSignUp(this.preopenSignUp);\n    }\n\n    this.premountSignInNodes.forEach(\n      (props: SignInProps, node: HTMLDivElement) => {\n        clerkjs.mountSignIn(node, props);\n      },\n    );\n\n    this.premountSignUpNodes.forEach(\n      (props: SignUpProps, node: HTMLDivElement) => {\n        clerkjs.mountSignUp(node, props);\n      },\n    );\n\n    this.premountUserProfileNodes.forEach(\n      (props: UserProfileProps, node: HTMLDivElement) => {\n        clerkjs.mountUserProfile(node, props);\n      },\n    );\n\n    this.premountUserButtonNodes.forEach(\n      (props: UserProfileProps, node: HTMLDivElement) => {\n        clerkjs.mountUserButton(node, props);\n      },\n    );\n\n    this._loaded = true;\n\n    return this.clerkjs;\n  };\n\n  get client(): ClientResource | undefined {\n    if (this.clerkjs) {\n      return this.clerkjs.client;\n      // TODO: add ssr condition\n    } else {\n      return undefined;\n    }\n  }\n\n  get session(): SessionResource | undefined | null {\n    if (this.clerkjs) {\n      return this.clerkjs.session;\n      // TODO: add ssr condition\n    } else {\n      return undefined;\n    }\n  }\n\n  get user(): UserResource | undefined | null {\n    if (this.clerkjs) {\n      return this.clerkjs.user;\n      // TODO: add ssr condition\n    } else {\n      return undefined;\n    }\n  }\n\n  get environment(): EnvironmentResource | undefined | null {\n    if (this.clerkjs) {\n      return this.clerkjs.environment;\n      // TODO: add ssr condition\n    } else {\n      return undefined;\n    }\n  }\n\n  setSession = (\n    session: SessionResource | string | null,\n    beforeEmit?: (session: SessionResource | null) => void | Promise<any>,\n  ) => {\n    if (this.clerkjs) {\n      return this.clerkjs.setSession(session, beforeEmit);\n    } else {\n      return Promise.reject();\n    }\n  };\n\n  openSignIn = (props?: SignInProps) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.openSignIn(props);\n    } else {\n      this.preopenSignIn = props;\n    }\n  };\n\n  closeSignIn = () => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.closeSignIn();\n    } else {\n      this.preopenSignIn = null;\n    }\n  };\n\n  openSignUp = (props?: SignUpProps) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.openSignUp(props);\n    } else {\n      this.preopenSignUp = props;\n    }\n  };\n\n  closeSignUp = () => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.closeSignUp();\n    } else {\n      this.preopenSignUp = null;\n    }\n  };\n\n  mountSignIn = (node: HTMLDivElement, props: SignInProps) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.mountSignIn(node, props);\n    } else {\n      this.premountSignInNodes.set(node, props);\n    }\n  };\n\n  unmountSignIn = (node: HTMLDivElement) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.unmountSignIn(node);\n    } else {\n      this.premountSignInNodes.delete(node);\n    }\n  };\n\n  mountSignUp = (node: HTMLDivElement, props: SignUpProps) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.mountSignUp(node, props);\n    } else {\n      this.premountSignUpNodes.set(node, props);\n    }\n  };\n\n  unmountSignUp = (node: HTMLDivElement) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.unmountSignUp(node);\n    } else {\n      this.premountSignUpNodes.delete(node);\n    }\n  };\n\n  mountUserProfile = (node: HTMLDivElement, props: UserProfileProps) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.mountUserProfile(node, props);\n    } else {\n      this.premountUserProfileNodes.set(node, props);\n    }\n  };\n\n  unmountUserProfile = (node: HTMLDivElement) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.unmountUserProfile(node);\n    } else {\n      this.premountUserProfileNodes.delete(node);\n    }\n  };\n\n  mountUserButton = (node: HTMLDivElement, props: UserButtonProps) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.mountUserButton(node, props);\n    } else {\n      this.premountUserButtonNodes.set(node, props);\n    }\n  };\n\n  unmountUserButton = (node: HTMLDivElement) => {\n    if (this.clerkjs && this._loaded) {\n      this.clerkjs.unmountUserButton(node);\n    } else {\n      this.premountUserButtonNodes.delete(node);\n    }\n  };\n\n  addListener = (listener: (emission: Resources) => void) => {\n    const callback = () => this.clerkjs?.addListener(listener);\n    if (this.clerkjs) {\n      callback();\n    } else {\n      this.premountMethodCalls.set('addListener', callback);\n    }\n  };\n\n  loadFromServer = (token: string) => {\n    if (this.mode === 'browser') {\n      void this.throwError(\n        'loadFromServer cannot be called in a browser context.',\n      );\n    }\n\n    this.ssrData = JSON.stringify({\n      client: this.client,\n      session: this.session,\n      token: token,\n    });\n  };\n\n  navigate = (to: string): void => {\n    const callback = () => this.clerkjs?.navigate(to);\n    if (this.clerkjs && this._loaded) {\n      void callback();\n    } else {\n      this.premountMethodCalls.set('navigate', callback);\n    }\n  };\n\n  redirectToSignIn = (): void => {\n    const callback = () => this.clerkjs?.redirectToSignIn();\n    if (this.clerkjs && this._loaded) {\n      callback();\n    } else {\n      this.premountMethodCalls.set('redirectToSignIn', callback);\n    }\n  };\n\n  redirectToSignUp = (): void => {\n    const callback = () => this.clerkjs?.redirectToSignUp();\n    if (this.clerkjs && this._loaded) {\n      callback();\n    } else {\n      this.premountMethodCalls.set('redirectToSignUp', callback);\n    }\n  };\n\n  redirectToUserProfile = (): void => {\n    const callback = () => this.clerkjs?.redirectToUserProfile();\n    if (this.clerkjs && this._loaded) {\n      callback();\n    } else {\n      this.premountMethodCalls.set('redirectToUserProfile', callback);\n    }\n  };\n\n  signOut = async (signOutCallback?: SignOutCallback): Promise<void> => {\n    const callback = () => this.clerkjs?.signOut(signOutCallback);\n    if (this.clerkjs && this._loaded) {\n      return callback() as Promise<void>;\n    } else {\n      this.premountMethodCalls.set('signOut', callback);\n    }\n  };\n\n  signOutOne = async (signOutCallback?: SignOutCallback): Promise<void> => {\n    const callback = () => this.clerkjs?.signOutOne(signOutCallback);\n    if (this.clerkjs && this._loaded) {\n      return callback() as Promise<void>;\n    } else {\n      this.premountMethodCalls.set('signOutOne', callback);\n    }\n  };\n}\n","import {\n  noClerkProviderError,\n  noGuaranteedLoadedError,\n  noGuaranteedUserError,\n} from '../errors';\n\nexport function assertWrappedByClerkProvider(\n  contextVal: unknown,\n): asserts contextVal {\n  if (!contextVal) {\n    throw new Error(noClerkProviderError);\n  }\n}\n\nexport function assertClerkLoadedGuarantee(\n  guarantee: unknown,\n  hookName: string,\n): asserts guarantee {\n  if (!guarantee) {\n    throw new Error(noGuaranteedLoadedError(hookName));\n  }\n}\n\nexport function assertUserGuarantee(\n  guarantee: unknown,\n  hookName: string,\n): asserts guarantee {\n  if (!guarantee) {\n    throw new Error(noGuaranteedUserError(hookName));\n  }\n}\n","import React from 'react';\n\nexport interface StructureContextValue {\n  guaranteedLoaded: boolean;\n  guaranteedUser: boolean;\n}\n\n// TODO: alternatively, split it into a context\n// per protected provider\nexport const StructureContextStates = Object.freeze({\n  noGuarantees: Object.freeze({\n    guaranteedLoaded: false,\n    guaranteedUser: false,\n  }),\n  guaranteedLoaded: Object.freeze({\n    guaranteedLoaded: true,\n    guaranteedUser: false,\n  }),\n  guaranteedAll: Object.freeze({\n    guaranteedLoaded: true,\n    guaranteedUser: true,\n  }),\n});\n\nexport const StructureContext = React.createContext<\n  StructureContextValue | undefined\n>(undefined);\nStructureContext.displayName = 'StructureContext';\n","import React, { useContext } from 'react';\nimport IsomorphicClerk from '../isomorphicClerk';\nimport {\n  assertClerkLoadedGuarantee,\n  assertWrappedByClerkProvider,\n} from './assertHelpers';\nimport {\n  StructureContext,\n  StructureContextStates,\n} from '../contexts/StructureContext';\nimport { inBrowser } from '../utils';\nimport { hocChildrenNotAFunctionError } from '../errors';\nimport { LoadedClerk } from '../types';\n\ntype IsomorphicClerkContextValue = {\n  value: IsomorphicClerk;\n};\nexport const IsomorphicClerkContext = React.createContext<\n  IsomorphicClerkContextValue | undefined\n>(undefined);\nIsomorphicClerkContext.displayName = 'IsomorphicClerkContext';\n\nexport const useClerk = (): LoadedClerk => {\n  const structureCtx = useContext(StructureContext);\n  const clerkCtx = useContext(IsomorphicClerkContext);\n  assertWrappedByClerkProvider(structureCtx);\n  assertWrappedByClerkProvider(clerkCtx);\n  assertClerkLoadedGuarantee(structureCtx.guaranteedLoaded, 'useClerk()');\n  assertClerkLoadedGuarantee(clerkCtx.value, 'useClerk()');\n  //  The value is an instance of IsomorphicClerk, not Clerk\n  // TODO: Remove type cast\n  return (clerkCtx.value as unknown) as LoadedClerk;\n};\n\nexport const withClerk = <P extends { clerk: LoadedClerk }>(\n  Component: React.ComponentType<P>,\n  displayName?: string,\n) => {\n  displayName =\n    displayName || Component.displayName || Component.name || 'Component';\n  Component.displayName = displayName;\n  const HOC = (props: Omit<P, 'clerk'>) => {\n    const structureCtx = useContext(StructureContext);\n    const clerkCtx = useContext(IsomorphicClerkContext);\n\n    if (!inBrowser()) {\n      return null;\n    }\n\n    assertWrappedByClerkProvider(structureCtx);\n    assertWrappedByClerkProvider(clerkCtx);\n\n    const clerk = (clerkCtx.value as unknown) as LoadedClerk;\n    if (!clerk) {\n      return null;\n    }\n\n    if (structureCtx.guaranteedLoaded) {\n      return <Component {...(props as P)} clerk={clerk} />;\n    }\n\n    if (clerk.client) {\n      return (\n        <StructureContext.Provider\n          value={StructureContextStates.guaranteedLoaded}\n        >\n          <Component {...(props as P)} clerk={clerk} />\n        </StructureContext.Provider>\n      );\n    }\n\n    return null;\n  };\n  HOC.displayName = `withClerk(${displayName})`;\n  return HOC;\n};\n\nexport const WithClerk: React.FC<{\n  children: (clerk: LoadedClerk) => React.ReactNode;\n}> = ({ children }) => (\n  <StructureContext.Consumer>\n    {structureCtx => (\n      <IsomorphicClerkContext.Consumer>\n        {clerkCtx => {\n          if (typeof children !== 'function') {\n            throw new Error(hocChildrenNotAFunctionError);\n          }\n\n          assertWrappedByClerkProvider(structureCtx);\n          assertWrappedByClerkProvider(clerkCtx);\n\n          const clerk = (clerkCtx.value as unknown) as LoadedClerk;\n          if (!clerk) {\n            return null;\n          }\n\n          if (structureCtx.guaranteedLoaded) {\n            return children(clerk);\n          }\n\n          if (clerk.client) {\n            return (\n              <StructureContext.Provider\n                value={StructureContextStates.guaranteedLoaded}\n              >\n                {children(clerk)}\n              </StructureContext.Provider>\n            );\n          }\n\n          return null;\n        }}\n      </IsomorphicClerkContext.Consumer>\n    )}\n  </StructureContext.Consumer>\n);\n","import React, { useContext } from 'react';\nimport {\n  ClientResource,\n  SessionResource,\n  SignInResource,\n  SignUpResource,\n} from '@clerk/types';\nimport {\n  assertClerkLoadedGuarantee,\n  assertWrappedByClerkProvider,\n} from './assertHelpers';\nimport { StructureContext } from './StructureContext';\n\ntype ClientContextValue = { value: ClientResource | undefined | null };\nexport const ClientContext = React.createContext<\n  ClientContextValue | undefined\n>(undefined);\nClientContext.displayName = 'ClientContext';\n\nexport function useSignIn(): SignInResource {\n  const structureCtx = useContext(StructureContext);\n  const clientCtx = React.useContext(ClientContext);\n  assertWrappedByClerkProvider(clientCtx);\n  assertWrappedByClerkProvider(structureCtx);\n  assertClerkLoadedGuarantee(structureCtx.guaranteedLoaded, 'useSignIn()');\n  return (clientCtx.value as ClientResource).signIn;\n}\n\nexport function useSignUp(): SignUpResource {\n  const structureCtx = useContext(StructureContext);\n  const clientCtx = React.useContext(ClientContext);\n  assertWrappedByClerkProvider(clientCtx);\n  assertWrappedByClerkProvider(structureCtx);\n  assertClerkLoadedGuarantee(structureCtx.guaranteedLoaded, 'useSignUp()');\n  return (clientCtx.value as ClientResource).signUp;\n}\n\nexport function useSessionList(): SessionResource[] {\n  const structureCtx = useContext(StructureContext);\n  const clientCtx = React.useContext(ClientContext);\n  assertWrappedByClerkProvider(clientCtx);\n  assertWrappedByClerkProvider(structureCtx);\n  assertClerkLoadedGuarantee(structureCtx.guaranteedLoaded, 'useSessionList()');\n  return (clientCtx.value as ClientResource).sessions;\n}\n","import React, { useContext } from 'react';\nimport { SessionResource } from '@clerk/types';\nimport {\n  assertUserGuarantee,\n  assertWrappedByClerkProvider,\n} from './assertHelpers';\nimport { StructureContext } from './StructureContext';\n\ntype SessionContextValue = { value: SessionResource | null | undefined };\nexport const SessionContext = React.createContext<\n  SessionContextValue | undefined\n>(undefined);\nSessionContext.displayName = 'SessionContext';\n\nexport function useSession(): SessionResource {\n  const structureCtx = useContext(StructureContext);\n  const sessionCtx = React.useContext(SessionContext);\n  assertWrappedByClerkProvider(sessionCtx);\n  assertWrappedByClerkProvider(structureCtx);\n  assertUserGuarantee(structureCtx.guaranteedUser, 'useSession()');\n  return sessionCtx.value as SessionResource;\n}\n","import React, { useContext } from 'react';\nimport { UserResource } from '@clerk/types';\nimport {\n  assertUserGuarantee,\n  assertWrappedByClerkProvider,\n} from './assertHelpers';\nimport {\n  StructureContext,\n  StructureContextStates,\n} from '../contexts/StructureContext';\nimport { inBrowser } from '../utils';\nimport { hocChildrenNotAFunctionError } from '../errors';\n\ntype UserContextValue = { value: UserResource | null | undefined };\nexport const UserContext = React.createContext<UserContextValue | undefined>(\n  undefined,\n);\nUserContext.displayName = 'UserContext';\n\nexport function useUserContext(): UserContextValue {\n  const userCtx = useContext(UserContext);\n  assertWrappedByClerkProvider(userCtx);\n  return userCtx;\n}\n\nexport function useUser(): UserResource {\n  const structureCtx = useContext(StructureContext);\n  assertWrappedByClerkProvider(structureCtx);\n  assertUserGuarantee(structureCtx.guaranteedUser, 'useUser()');\n\n  const userCtx = useUserContext();\n  assertUserGuarantee(userCtx.value, 'useUser()');\n  return userCtx.value;\n}\n\nexport const withUser = <P extends { user: UserResource }>(\n  Component: React.ComponentType<P>,\n  displayName?: string,\n) => {\n  displayName =\n    displayName || Component.displayName || Component.name || 'Component';\n  Component.displayName = displayName;\n\n  const HOC: React.FC<Omit<P, 'user'>> = (props: Omit<P, 'user'>) => {\n    const structureCtx = useContext(StructureContext);\n    const userCtx = useContext(UserContext);\n    if (!inBrowser()) {\n      return null;\n    }\n    assertWrappedByClerkProvider(structureCtx);\n    assertWrappedByClerkProvider(userCtx);\n    const user = userCtx.value;\n\n    if (structureCtx.guaranteedUser && user) {\n      return <Component {...(props as P)} user={user} />;\n    }\n\n    if (user) {\n      return (\n        <StructureContext.Provider value={StructureContextStates.guaranteedAll}>\n          <Component {...(props as P)} user={user} />\n        </StructureContext.Provider>\n      );\n    }\n\n    return null;\n  };\n\n  HOC.displayName = `withUser(${displayName})`;\n  return HOC;\n};\n\nexport const WithUser: React.FC<{\n  children: (user: UserResource) => React.ReactNode;\n}> = ({ children }) => (\n  <StructureContext.Consumer>\n    {structureCtx => (\n      <UserContext.Consumer>\n        {userCtx => {\n          if (typeof children !== 'function') {\n            throw new Error(hocChildrenNotAFunctionError);\n          }\n\n          assertWrappedByClerkProvider(structureCtx);\n          assertWrappedByClerkProvider(userCtx);\n          const user = userCtx.value;\n\n          if (structureCtx.guaranteedUser && user) {\n            return children(user);\n          }\n\n          if (user) {\n            return (\n              <StructureContext.Provider\n                value={StructureContextStates.guaranteedAll}\n              >\n                {children(user)}\n              </StructureContext.Provider>\n            );\n          }\n\n          return null;\n        }}\n      </UserContext.Consumer>\n    )}\n  </StructureContext.Consumer>\n);\n","import React from 'react';\nimport { ClientResource, Resources } from '@clerk/types';\nimport IsomorphicClerk from '../isomorphicClerk';\nimport { IsomorphicClerkContext } from './IsomorphicClerkContext';\nimport { ClientContext } from './ClientContext';\nimport { SessionContext } from './SessionContext';\nimport { UserContext } from './UserContext';\n\ntype ClerkContextWrapperProps = {\n  isomorphicClerk: IsomorphicClerk;\n  children: React.ReactNode;\n  clerkLoaded: boolean;\n};\n\ntype ClerkContextProviderState = Resources;\n\nexport function ClerkContextWrapper({\n  isomorphicClerk,\n  children,\n  clerkLoaded,\n}: ClerkContextWrapperProps): JSX.Element | null {\n  const clerk = isomorphicClerk;\n\n  const [state, setState] = React.useState<ClerkContextProviderState>({\n    client: clerk.client as ClientResource,\n    session: clerk.session,\n    user: clerk.user,\n  });\n\n  React.useEffect(() => {\n    return clerk.addListener(e => setState({ ...e }));\n  }, []);\n\n  const { client, session, user } = state;\n  const clerkCtx = React.useMemo(() => ({ value: clerk }), [clerkLoaded]);\n  const clientCtx = React.useMemo(() => ({ value: client }), [client]);\n  const sessionCtx = React.useMemo(() => ({ value: session }), [session]);\n  const userCtx = React.useMemo(() => ({ value: user }), [user]);\n\n  return (\n    <IsomorphicClerkContext.Provider value={clerkCtx}>\n      <ClientContext.Provider value={clientCtx}>\n        <SessionContext.Provider value={sessionCtx}>\n          <UserContext.Provider value={userCtx}>\n            <React.Fragment key={session ? session.id : 'no-users'}>\n              {children}\n            </React.Fragment>\n          </UserContext.Provider>\n        </SessionContext.Provider>\n      </ClientContext.Provider>\n    </IsomorphicClerkContext.Provider>\n  );\n}\n","import React, { useEffect, useMemo, useState } from 'react';\nimport IsomorphicClerk from '../isomorphicClerk';\nimport { withMaxAllowedInstancesGuard } from '../utils';\nimport { multipleClerkProvidersError } from '../errors';\nimport { ClerkContextWrapper } from './ClerkContextWrapper';\nimport { StructureContext, StructureContextStates } from './StructureContext';\nimport { BrowserClerkConstructor, ClerkOptions } from '../types';\n\nexport interface ClerkProviderProps extends ClerkOptions {\n  frontendApi?: string;\n  Clerk?: BrowserClerkConstructor;\n}\n\nfunction ClerkProviderBase(props: React.PropsWithChildren<ClerkProviderProps>) {\n  const clerk = useMemo(() => {\n    const { frontendApi = '', Clerk: ClerkConstructor, ...rest } = props;\n    return new IsomorphicClerk(frontendApi, rest, ClerkConstructor);\n  }, []);\n\n  const [clerkLoaded, setClerkLoaded] = useState(false);\n\n  useEffect(() => {\n    void clerk.loadClerkJS().then(() => setClerkLoaded(true));\n  }, []);\n\n  return (\n    <StructureContext.Provider value={StructureContextStates.noGuarantees}>\n      {clerk instanceof IsomorphicClerk && clerk.ssrData && (\n        <script\n          type='application/json'\n          data-clerk='SSR'\n          dangerouslySetInnerHTML={{ __html: clerk.ssrData }}\n        />\n      )}\n      <ClerkContextWrapper isomorphicClerk={clerk} clerkLoaded={clerkLoaded}>\n        {props.children}\n      </ClerkContextWrapper>\n    </StructureContext.Provider>\n  );\n}\n\nexport const ClerkProvider = withMaxAllowedInstancesGuard(\n  ClerkProviderBase,\n  'ClerkProvider',\n  multipleClerkProvidersError,\n);\n","import React from 'react';\nimport {\n  SignInProps,\n  SignUpProps,\n  UserButtonProps,\n  UserProfileProps,\n} from '@clerk/types';\nimport { MountProps, WithClerkProp } from '../types';\nimport { withClerk } from '../contexts';\n\n// README: <Portal/> should be a class pure component in order for mount and unmount\n// lifecycle props to be invoked correctly. Replacing the class component with a\n// functional component wrapped with a React.memo is not identical to the original\n// class implementation due to React intricacies such as the useEffectâ€™s cleanup\n// seems to run AFTER unmount, while componentWillUnmount runs BEFORE.\n\n// More information can be found at https://clerkinc.slack.com/archives/C015S0BGH8R/p1624891993016300\n\n// The function Portal implementation is commented out for future reference.\n\n// const Portal = React.memo(({ props, mount, unmount }: MountProps) => {\n//   const portalRef = React.createRef<HTMLDivElement>();\n\n//   useEffect(() => {\n//     if (portalRef.current) {\n//       mount(portalRef.current, props);\n//     }\n//     return () => {\n//       if (portalRef.current) {\n//         unmount(portalRef.current);\n//       }\n//     };\n//   }, []);\n\n//   return <div ref={portalRef} />;\n// });\n\n// Portal.displayName = 'ClerkPortal';\nclass Portal extends React.PureComponent<MountProps, {}> {\n  private portalRef = React.createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    if (this.portalRef.current) {\n      this.props.mount(this.portalRef.current, this.props.props);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.portalRef.current) {\n      this.props.unmount(this.portalRef.current);\n    }\n  }\n\n  render() {\n    return <div ref={this.portalRef} />;\n  }\n}\n\nexport const SignIn = withClerk(\n  ({ clerk, ...props }: WithClerkProp<SignInProps>) => {\n    return (\n      <Portal\n        mount={clerk.mountSignIn}\n        unmount={clerk.unmountSignIn}\n        props={props}\n      />\n    );\n  },\n  'SignIn',\n);\n\nexport const SignUp = withClerk(\n  ({ clerk, ...props }: WithClerkProp<SignUpProps>) => {\n    return (\n      <Portal\n        mount={clerk.mountSignUp}\n        unmount={clerk.unmountSignUp}\n        props={props}\n      />\n    );\n  },\n  'SignUp',\n);\n\nexport const UserProfile = withClerk(\n  ({ clerk, ...props }: WithClerkProp<UserProfileProps>) => {\n    return (\n      <Portal\n        mount={clerk.mountUserProfile}\n        unmount={clerk.unmountUserProfile}\n        props={props}\n      />\n    );\n  },\n  'UserProfile',\n);\n\nexport const UserButton = withClerk(\n  ({ clerk, ...props }: WithClerkProp<UserButtonProps>) => {\n    return (\n      <Portal\n        mount={clerk.mountUserButton}\n        unmount={clerk.unmountUserButton}\n        props={props}\n      />\n    );\n  },\n  'UserButton',\n);\n","import React from 'react';\nimport { withClerk, withUser } from '../contexts';\nimport { useUserContext } from '../contexts/UserContext';\n\nexport const SignedIn: React.FC = withUser(({ children }) => {\n  return <>{children}</>;\n}, 'SignedIn');\n\nexport const SignedOut: React.FC = withClerk(({ children }) => {\n  const userCtx = useUserContext();\n  return userCtx.value === null ? <>{children}</> : null;\n}, 'SignedOut');\n\nexport const ClerkLoaded: React.FC = withClerk(({ children }) => {\n  return <>{children}</>;\n}, 'ClerkLoaded');\n\nexport const RedirectToSignIn = withClerk(({ clerk }) => {\n  const { client, environment, session } = clerk;\n  const hasActiveSessions =\n    client.activeSessions && client.activeSessions.length > 0;\n  React.useEffect(() => {\n    if (session === null && hasActiveSessions && environment) {\n      const { afterSignOutOneUrl } = environment.displayConfig;\n      void clerk.navigate(afterSignOutOneUrl);\n    } else {\n      clerk.redirectToSignIn();\n    }\n  }, []);\n  return null;\n}, 'RedirectToSignIn');\n\nexport const RedirectToSignUp = withClerk(({ clerk }) => {\n  React.useEffect(() => {\n    clerk.redirectToSignUp();\n  }, []);\n  return null;\n}, 'RedirectToSignUp');\n\nexport const RedirectToUserProfile = withClerk(({ clerk }) => {\n  React.useEffect(() => {\n    clerk.redirectToUserProfile();\n  }, []);\n  return null;\n}, 'redirectToUserProfile');\n"],"names":["inBrowser","window","FAILED_TO_LOAD_ERROR","MISSING_PROVIDER_ERROR","MISSING_BODY_ERROR","isStaging","frontendApi","endsWith","getScriptSrc","localScriptSrc","majorVersion","parseInt","version","split","loadScript","Promise","resolve","reject","Clerk","script","document","createElement","src","setAttribute","async","body","addEventListener","appendChild","counts","Map","useMaxAllowedInstancesGuard","name","error","maxCount","React","useEffect","count","get","Error","set","withMaxAllowedInstancesGuard","WrappedComponent","displayName","Hoc","props","noFrontendApiError","noClerkProviderError","noGuaranteedLoadedError","hookName","noGuaranteedUserError","multipleClerkProvidersError","hocChildrenNotAFunctionError","IsomorphicClerk","options","clerkjs","premountMethodCalls","forEach","cb","preopenSignIn","openSignIn","preopenSignUp","openSignUp","premountSignInNodes","node","mountSignIn","premountSignUpNodes","mountSignUp","premountUserProfileNodes","mountUserProfile","premountUserButtonNodes","mountUserButton","_loaded","session","beforeEmit","setSession","closeSignIn","closeSignUp","unmountSignIn","unmountSignUp","unmountUserProfile","unmountUserButton","listener","callback","addListener","token","mode","throwError","ssrData","JSON","stringify","client","to","navigate","redirectToSignIn","redirectToSignUp","redirectToUserProfile","signOutCallback","signOut","signOutOne","ClerkConstructor","loadClerkJS","load","then","hydrateClerkJS","err","message","scriptUrl","errorMsg","process","env","NODE_ENV","console","undefined","user","environment","assertWrappedByClerkProvider","contextVal","assertClerkLoadedGuarantee","guarantee","assertUserGuarantee","StructureContextStates","Object","freeze","noGuarantees","guaranteedLoaded","guaranteedUser","guaranteedAll","StructureContext","createContext","IsomorphicClerkContext","useClerk","structureCtx","useContext","clerkCtx","value","withClerk","Component","HOC","clerk","Provider","WithClerk","children","Consumer","ClientContext","useSignIn","clientCtx","signIn","useSignUp","signUp","useSessionList","sessions","SessionContext","useSession","sessionCtx","UserContext","useUserContext","userCtx","useUser","withUser","WithUser","ClerkContextWrapper","isomorphicClerk","clerkLoaded","useState","state","setState","e","useMemo","Fragment","key","id","ClerkProviderBase","rest","setClerkLoaded","type","dangerouslySetInnerHTML","__html","ClerkProvider","Portal","createRef","componentDidMount","portalRef","current","mount","componentWillUnmount","unmount","render","ref","PureComponent","SignIn","SignUp","UserProfile","UserButton","SignedIn","SignedOut","ClerkLoaded","RedirectToSignIn","hasActiveSessions","activeSessions","length","afterSignOutOneUrl","displayConfig","RedirectToSignUp","RedirectToUserProfile"],"mappings":"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"}